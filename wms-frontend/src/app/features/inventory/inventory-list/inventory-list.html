<div class="space-y-6">

  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
    <div>
      <h2 class="text-2xl font-bold text-slate-800 tracking-tight flex items-center gap-3">
        <span class="bg-indigo-100 text-indigo-600 p-2 rounded-lg">
          <i class="bi bi-layers-fill"></i>
        </span>
        Stock en Tiempo Real
      </h2>
      <p class="text-slate-500 text-sm mt-1 ml-12">Visualización consolidada de todas las existencias por LPN.</p>
    </div>
    
    <button (click)="loadInventories()" 
            class="group bg-white border border-slate-300 hover:border-indigo-500 text-slate-600 hover:text-indigo-600 px-4 py-2 rounded-lg shadow-sm transition-all duration-300 flex items-center gap-2 font-medium">
      <i class="bi bi-arrow-clockwise group-hover:rotate-180 transition-transform duration-500"></i>
      <span>Actualizar Datos</span>
    </button>
  </div>

  <div class="bg-white shadow-md rounded-xl overflow-hidden border border-slate-200 relative min-h-[300px]">
    
    <div *ngIf="isLoading" class="absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-indigo-600">
      <div class="w-10 h-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-3"></div>
      <span class="font-medium text-sm">Sincronizando inventario...</span>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">LPN (Etiqueta)</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Producto</th>
            <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Cantidad</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Ubicación</th>
            <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Estado</th>
            <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Trazabilidad</th>
          </tr>
        </thead>
        
        <tbody class="bg-white divide-y divide-slate-200">
          <tr *ngFor="let item of inventoryItems" class="hover:bg-indigo-50/30 transition-colors group">
            
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <i class="bi bi-qr-code text-slate-400"></i>
                <span class="font-mono font-bold text-indigo-700 bg-indigo-50 px-2 py-1 rounded border border-indigo-100 text-xs tracking-wide select-all">
                  {{ item.lpn }}
                </span>
              </div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex flex-col">
                <span class="font-bold text-slate-800 text-sm">{{ item.productSku }}</span>
                <span class="text-xs text-slate-500 flex items-center gap-1">
                  <i class="bi bi-box-seam"></i> Lote: {{ item.batchNumber }}
                </span>
              </div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-center">
              <span class="font-mono font-bold text-lg text-slate-700">{{ item.quantity }}</span>
              <span class="text-xs text-slate-400 ml-1">un.</span>
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
                  <i class="bi bi-geo-alt-fill"></i>
                </div>
                <span class="font-mono font-medium text-slate-700">{{ item.locationCode }}</span>
              </div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-center">
              <span class="px-3 py-1 inline-flex items-center gap-1.5 text-xs font-bold rounded-full border shadow-sm"
                    [ngClass]="{
                      'bg-emerald-100 text-emerald-700 border-emerald-200': item.status === 'AVAILABLE',
                      'bg-amber-100 text-amber-700 border-amber-200': item.status === 'IN_QUALITY_CHECK',
                      'bg-violet-100 text-violet-700 border-violet-200': item.status === 'RESERVED',
                      'bg-slate-100 text-slate-500 border-slate-200': item.status === 'SHIPPED',
                      'bg-rose-100 text-rose-700 border-rose-200': isCritical(item.status)
                    }">
                <span class="w-1.5 h-1.5 rounded-full" 
                      [ngClass]="{
                        'bg-emerald-500': item.status === 'AVAILABLE',
                        'bg-amber-500': item.status === 'IN_QUALITY_CHECK',
                        'bg-violet-500': item.status === 'RESERVED',
                        'bg-slate-400': item.status === 'SHIPPED',
                        'bg-rose-500': isCritical(item.status)
                      }"></span>
                {{ item.status.replace('_', ' ') }}
              </span>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-right text-xs text-slate-400">
              <div class="flex flex-col items-end">
                <span class="flex items-center gap-1">
                  {{ item.expiryDate | date:'dd/MM/yy' }} <i class="bi bi-calendar-x text-rose-400" title="Vencimiento"></i>
                </span>
                <span class="text-[10px] mt-0.5 opacity-70">Vence</span>
              </div>
            </td>

          </tr>

          <tr *ngIf="!isLoading && inventoryItems.length === 0">
            <td colspan="6" class="px-6 py-16 text-center">
              <div class="flex flex-col items-center justify-center">
                <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-4">
                  <i class="bi bi-box2 text-4xl text-slate-300"></i>
                </div>
                <h3 class="text-slate-800 font-bold text-lg">El depósito está vacío</h3>
                <p class="text-slate-500 text-sm max-w-xs mx-auto mt-1">
                  No hay mercadería registrada en este momento. Comienza recibiendo productos en la sección de operaciones.
                </p>
                <a routerLink="/ingresos" class="mt-6 text-indigo-600 font-bold hover:text-indigo-800 text-sm hover:underline flex items-center gap-2">
                  Ir a Recepción <i class="bi bi-arrow-right"></i>
                </a>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>
</div>